<best_practices>
  <general_principles>
    <principle priority="high">
      <name>Environment Clarity First</name>
      <description>Always determine and confirm the correct environment (MY/SG) before executing any commands</description>
      <rationale>Using the wrong tool leads to incorrect data and wasted time</rationale>
      <example>
        <scenario>User mentions "payment issue"</scenario>
        <good>Ask: "Is this for Malaysia (mybuddy) or Singapore (sgbuddy)?"</good>
        <bad>Assume mybuddy and run commands</bad>
      </example>
    </principle>

    <principle priority="high">
      <name>Batch Processing Efficiency</name>
      <description>For 3+ transactions, always create a batch file instead of running individual commands</description>
      <rationale>Batch processing saves time and provides consolidated output</rationale>
      <example>
        <scenario>Ticket has 10 transaction IDs</scenario>
        <good>Create txn_ids.txt with all IDs, then run: mybuddy txn txn_ids.txt</good>
        <bad>Run mybuddy txn 10 times with individual IDs</bad>
      </example>
    </principle>

    <principle priority="high">
      <name>Privacy Protection</name>
      <description>Never output raw customer PII, credentials, or sensitive data in chat responses</description>
      <rationale>Protecting customer privacy is a critical operational requirement</rationale>
      <example>
        <scenario>Transaction investigation shows customer details</scenario>
        <good>Report: "Transaction found with status X, remediation SQL generated"</good>
        <bad>Report: "Customer John Doe (ID: 12345) has failed transaction..."</bad>
      </example>
    </principle>

    <principle priority="medium">
      <name>Rollback SQL Safety</name>
      <description>Always generate and save rollback SQL for RPP operations before proceeding</description>
      <rationale>Rollback capability is essential for production database changes</rationale>
      <example>
        <scenario>Running mybuddy rpp resume command</scenario>
        <good>Save both deploy and rollback SQL to files for documentation</good>
        <bad>Only save deploy SQL without rollback capability</bad>
      </example>
    </principle>
  </general_principles>

  <environment_detection>
    <convention category="environment_clues">
      <rule>Check for context clues in tickets to determine environment</rule>
      <examples>
        <good>TS-XXXX → Malaysia (mybuddy)</good>
        <good>TSE-XXXX → Singapore (sgbuddy)</good>
        <good>MYR currency → Malaysia (mybuddy)</good>
        <good>SGD currency → Singapore (sgbuddy)</good>
      </examples>
    </convention>
  </environment_detection>

  <transaction_id_patterns>
    <convention category="id_formats">
      <rule>Recognize different transaction ID formats</rule>
      <patterns>
        <pattern>Regular Transaction ID: 20251228TNGDMYNB010ORM77048250</pattern>
        <pattern>RPP E2E ID: 20251228GXSPMYXXXXXXXXXXXXXXXX</pattern>
        <pattern>UUID: fd230a01dcd04282851b7b9dd6260c93</pattern>
      </patterns>
    </convention>
  </transaction_id_patterns>

  <common_pitfalls>
    <pitfall>
      <description>Using wrong environment tool</description>
      <why_problematic>Queries wrong database, returns incorrect or no results</why_problematic>
      <correct_approach>Always clarify environment first and verify Jira project prefix</correct_approach>
    </pitfall>

    <pitfall>
      <description>Not cleaning CSV data before processing</description>
      <why_problematic>Empty lines, carriage returns, and duplicate IDs cause errors</why_problematic>
      <correct_approach>Use sort -u | grep -v '^$' | sed 's/\r$//' to clean data</correct_approach>
    </pitfall>

    <pitfall>
      <description>Attempting to download attachments with sgbuddy</description>
      <why_problematic>sgbuddy does not support attachment downloads</why_problematic>
      <correct_approach>Use browser or curl to manually download attachments for SG tickets</correct_approach>
    </pitfall>

    <pitfall>
      <description>Executing SQL without review</description>
      <why_problematic>Can cause production data corruption or incorrect fixes</why_problematic>
      <correct_approach>Always review generated SQL against SOP case type before applying</correct_approach>
    </pitfall>
  </common_pitfalls>

  <quality_checklist>
    <category name="before_starting">
      <item>Environment (MY/SG) confirmed</item>
      <item>CLI tool (mybuddy/sgbuddy) available</item>
      <item>Environment variables configured</item>
      <item>Task requirements understood</item>
    </category>

    <category name="during_execution">
      <item>Correct tool being used for environment</item>
      <item>Transaction IDs extracted and validated</item>
      <item>Batch file created if processing multiple items</item>
      <item>SQL reviewed before application</item>
      <item>Rollback SQL saved for RPP operations</item>
    </category>

    <category name="before_completion">
      <item>Jira ticket updated with findings</item>
      <item>Remediation steps documented</item>
      <item>Privacy maintained (no PII in output)</item>
      <item>Task marked as resolved if applicable</item>
    </category>
  </quality_checklist>
</best_practices>
